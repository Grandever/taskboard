<task-form
  [taskToEdit]="selectedTask"
  (taskAdded)="onTaskAdded($event)"
  (taskUpdated)="onTaskUpdated($event)"
></task-form>

<!-- Task Detail Panel - Fixed Left Side Overlay -->
<div *ngIf="detailOpen && selectedTask" class="task-detail-panel">
  <app-task-detail 
    [taskInput]="selectedTask" 
    (close)="closeTaskDetail()" 
    (prev)="onPrev()" 
    (next)="onNext()">
  </app-task-detail>
</div>

<!-- Overlay -->
<div *ngIf="detailOpen" class="task-detail-overlay" (click)="closeTaskDetail()"></div>

<!-- Skeleton loading for board -->
<div *ngIf="loading" class="d-flex position-relative" style="gap: 16px;">
  <div class="board-grid" style="width: 100%">
    <div class="column" *ngFor="let i of [1,2,3,4,5]">
      <div class="column-header">
        <span><i class="bi bi-list-task me-2"></i>Loading...</span>
        <span class="task-count">0</span>
      </div>
      <div class="task-card skeleton-task" *ngFor="let j of [1,2,3]">
        <div class="skeleton-text" style="height: 1.5rem; margin-bottom: 0.5rem;"></div>
        <div class="skeleton-text" style="height: 1rem; width: 60%;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Actual board -->
<div *ngIf="!loading" class="board-container" [class.board-with-detail]="detailOpen">
  <div class="board-content">
    <div class="board-grid">
      <!-- Loop through Columns -->
      <div
        class="column highlighted" *ngFor="let column of columns"
        (dragover)="onDragOver($event)"
        (drop)="onDrop(column.name, $event)"
      >
        <div class="column-header">
          <span><i class="fas fa-{{ column.icon }} me-2"></i>{{ column.title }}</span>
          <span class="task-count">{{ column.tasks.length }}</span>
        </div>

        <!-- Column Body - Scrollable -->
        <div class="column-body">
          <!-- Display Tasks -->
          <div
            *ngFor="let task of column.tasks"
            class="task-card"
            [ngClass]="getPriorityClass(task.priority)"
            draggable="true"
            (dragstart)="onDragStart(task)"
            (dragend)="onDragEnd()"
            (dblclick)="editTask(task)"
            style="border: #00b8d9 1px solid; cursor: pointer;"
            (click)="openTaskDetail(task)"
          >
            <div class="task-title d-flex align-items-center justify-content-between">
              <span class="me-2">{{ task.title }}</span>
              <img *ngIf="task.assignee" [src]="'https://api.dicebear.com/7.x/identicon/svg?seed=' + task.assignee" width="20" height="20" class="rounded-circle" alt="assignee" />
            </div>
            <div class="task-meta">
              <span>Priority: {{ task.priority | titlecase }}</span>
              <span>Due: {{ task.due_date || 'None' }}</span>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="column.tasks.length === 0" class="empty-placeholder">
            <i>No tasks available in this column</i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- No Records Found - Board Level -->
  <div *ngIf="!loading && (!columns || columns.length === 0 || totalItems === 0)" class="board-no-records">
    <div class="d-flex flex-column align-items-center justify-content-center text-muted py-5" style="min-height: 400px;">
      <i class="bi bi-inbox fs-1 mb-3"></i>
      <div class="fs-5">No Records Found</div>
      <div class="text-muted mt-2">No tasks available to display on the board</div>
    </div>
  </div>
</div>

<!-- Pagination - Fixed at bottom -->
<div *ngIf="!loading && totalItems > 0" class="mt-auto pt-3">
  <app-paginator
    [currentPage]="currentPage"
    [itemsPerPage]="itemsPerPage"
    [totalItems]="totalItems"
    (pageChange)="onPageChange($event)"
    (pageSizeChange)="onPageSizeChange($event)"
  ></app-paginator>
</div>



